#Moika 

##Постановка проблемы
###Решаемые проблемы:
* Автомобилисты не хотят стоять в очередях на автомойки
* Автомобилисты хотят планировать свое время
* Автомобилисты хотят минимизировать свои затраты на автомойку
* Владельцы автомоек хотят увеличит число клиентов
* Владельцы автомоек хотят удержать имеющихся клиентов
* Владельцы автомоек хотят оптимизировать загрузку моек
* Владельцы автомоек хотят иметь оперативную информацию о загрузке моек и cash-flow
* Таким образом увеличит доходность бизнеса
###Заинтересованные лица:
            Автомобилист
            Менеджер (администратор) автомойки
            Владелец сервиса автомойки
### Цели:
            Повышение удобства автомобилистов
            Увеличение числа клиентов сети автомоек
            Увеличение прибыли владельцев автомоек
### Краткое описание планируемого продукта
        Предполагаемый продукт представляет собой ИТ-сервис, позволяющий:
            Автомобилистам находить удобную для себя автомойку (из зарегистрированных) и записываться на нее в удобное для него время. При этом он может выбирать набор услуг по мойке/чистке авто и ему сразу считывается стоимость услуг. Так же, в зависимости от настроек, действует система бонусов и скидок. Например, в зависимости от частоты мойки, выбранного набора услуг, типа авто и т.д. и т.п. Так же автомобилист может оценивать работу мойки (в виде балов) и оставлять записи в «книге жалоб/предложений”.
            Менеджерам автомоек иметь оперативную информацию о загрузке боксов моек, количестве клиентов в очереди и т.п.
            Владельцам моек иметь оперативную информацию об общей загрузке сети (с детализацией), генерируемом ей cash-flow, статистику, тенденции и т.п. Они могут устанавливать бонусные программы и моделировать их параметры.
            Сервис также может являться рекламной площадкой, как для собственно рекламы сети автомоек, так и для рекламы партнеров.
### Цикл использования
            Автовладелец заходит в приложение и выбирает удобную себе мойку
            Регистрация в сервисе для автовладельцев не требуется (только ввод № авто) и кэпчу
            Автовладелец резервирует удобное время
            Выбирает набор услуг
            Получает расчет стоимости (с учетом скидок и т.п.)
            Фиксирует время
            При желании оплачивает (плат. карта, яндекс-деньги, pay-pal, СМС-кой?) За это получает еще доп. скидку
            Автовладелец может так-же записаться по телефону (но без скидок)
            Может настроить напоминания по СМС
            Может потом видеть статистику по своим помывкам и суммы оплат
            Может выставит оценку и оставить отзыв
            Менеджер видит регистрации клиентов и загрузку боксов
            Устанавливает режим работы боксов
            Регистрирует клиентов по телефону
            Если приезжает клиент «с улицы» регистрирует его
            Видит оценки клиентов.
            Может клиентам ставить всякие метки (типа VIP, black-list и т.п.)
            Владелец видит общую загрузку по сети
            Устанавливает скидочные программы
            Видит статистику и аналитику
###Описание пользователей
        Автомобилист – человек, имеющий авто, доступ к Интернет и мобильное устройство (смартфон/планшет).
        Менеджер мойки – человек, управляющий работой конкретной автомойки, ее персоналом, очередью клиентов, расчетами с ними и отвечающий за эффективность работы мойки, имеет доступ к Сервису либо через Интернет, либо через локальную сеть, как через WEB-интерфейс, так и через мобильные устройства.
        Владелец (может быть одно лицо с менеджером) - собственник сети, получает информацию о работе сети и определяет параметры ее функционирования (расписания работы, бонусные программы и т.п.)
###Функции продукта
        Сервис регистрации
        Сервис выбора моек (Geo)
        Сервис оплаты
        Сервис клиентской лояльности
        Сервис статистики
###Дополнительные функциональные требования к продукту
        Пользователи продукта общаются с сервисом через WEB-интерфейс или мобильные приложения
        Продут может предоставляться как «облачный сервис»
        Интеграция с платежными системами (интернет-эквайринг)
        Опционально – интеграция с кассовым оборудованием и бухгалтерскими системам

#Принцыпы посторения проекта
Проект 2-х модульный. Модули в целом независимы. 
Для разработки:
* Beckend деплоится из IDE на Tomcat
* Frontend запускается через angular-cli (liteserv)

Для продакшена:
* Beckend деплоится на Tomcat в виде war с помощью maven
* Frontend билдится Ангуляром и выкладывается на любой удобный Web-server

Для взаимодействия Fronend и Backend в BackEnd должен быть настроена CORS на соответствующте адреса сервера FrontEnd (см. WebConfig.java)

###BackeEnd 
 JAVA, Spring WEB, Hibernate (PosgreSql), Tomcat
 Реализует REST сервисы (через Spring @RestController) в JSON. Собственного UI не имеет.
###FrontEnd
 Angular2|4, PrimeNgUi, Bootstrap
 Реализует WEB UI. Обменивается данными (в JSON) с BACKEnd`ом

#API (BackEnd)
## Общие принципы
 * Все сущности имеют свой контроллер
 * Один контроллер может покрывать несколько сущностей, 
    например, основную, и связанные с ней справочники и дочерние сущности
  * Запросы REST-подобные
  * Для enity используется "CamelStyle", но первая буква всего меленькая
  * Запросы строятся по принципу:
   
`   
/api/<_entiyName_>/<_queryType_>/<_parameter_>
      или
   /api/<_entiyName_>/<_childEntiyName_><_queryType_>/<_parameter_>`
   
   например
   
   ``` 
   /api/washFacility/list
   /api/washBox/byId/1
   `````
   * Типы запросов:
     * list - список всех обхектов
     * add - добавить
     * update - обновить
     * delete - удалит
     * byId - по id
     * byCode - по символьному коду
     * byNamу - по имени объекта
     
   * Взвращается всегда объект, содержащий данные или HTTP-статус 
     Объект затем парсится в JSON 
     
## Контроллеры
####Общий список готовых к употреблению контроллеров
* CarController.java
* ClientController.java
* PsServiceStatusController.java
* PsServiceTypeController.java
* PsWashBoxController.java
* PsWashFacilityController.java
* UserController.java
* WashAddrController.java
* WorkController.java

### PsWashFaclilityController
Управляет сущностями - мойками через REST.
Запросs в JSON
```json
{"name":"Мока на Фонтанке","idNet":"1","description":"не фонтан","idAddr":"3",
      "washBoxes": [
                           {"idType":"1","boxName":"Бокс №1","description":"Первй бокс", "boxStatus":"1"},
                           {"idType":"2","boxName":"Бокс №2","description":"Второй бокс", "boxStatus":"1"},
                           {"idType":"3","boxName":"Бокс №3","description":"Третий бокс", "boxStatus":"2"},
                           {"idType":"1","boxName":"Бокс №4","description":"Большой бокс", "boxStatus":"3"}
                           ]
}
```

* /api/washFacility/ - мойки
    * /list - список моек
    * /add - добавить
    * /update - изменить
    * /delete/{id} - удалить
    * /byId/{id} - получить по id
    * /inCity/{city} - список моек в городе
    ````
    {"id"="1","name"="Москва"}
    ````
    * /byCoord/{coord} - получение мойки по координатам
     ```json
    {"lat":"50.34555", "long":"67.23655"}
     ```
    * /byAddr/{idAddr} - получение мойки по адресу, зарегмтрированному в бд

### PsWashBoxController.java

* /api/washBox
    * /list
    * /add
     * /update - изменить
     * /delete - удалить
     * /byId/{id} - получить по id
     * /byType/{typeId}
     * /byStatus/{statusId}
     * /inFacility/{idFacility}
 

    
 

#FRONTEND
Подробнее по разворачиванию см. в fdrontend/readme.md

##Общие принципы расположения папок 
Кажлый тип программных объктов лежит в своей подпапке
- компооненты в /components
Компоненты группируются по отношению сущности, которую они обслуживают или функционалу 
- сущности в /model/entity
- сервисы доступа к данным в /model/services

## Рринцыпы построения
Предполагается одностаничный интерфейс
На каждый набор функционала, делается свой UI в виде меню набра роутов и компонентов, которые отражаются
На данный момент определены следующие наборы функционала:
* По умолчанию - для анонимных пользюнов, зашедших с улицы - рекламное бла-бла и возможность записатьм=ся на действующте мойки
* Для автовладельцев, то же что и дефолт, но с доб бла-бла и без бла-бал про выгоды владельцев автомоек
 + Упор делается на записи их на мойку
* Для потенциальных клиентов владельцев автомоек - блв-бла как это круто, предложени связаться с нами, отзыва клиентов
* Для зарегисрировавшихся, соответственно без бла-бла конкретный функционал

###Реализация
* Все это безобразие делается через замену содержимого Главной менюшки. При этом содержание и вид главного navbar`a не меняются.
* Также в зависимости от вида интерфейса меняются наборы rout`ов
* и соответственно компоненты на сраничке приземления, которая одна единственная
* Сообщение о смене интерфейса распространяется через rxJS/observer|subscription

